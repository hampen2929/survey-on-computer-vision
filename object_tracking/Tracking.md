# Towards Real-Time Multi-Object Tracking

https://arxiv.org/pdf/1909.12605v1.pdf

## 概要

トラッキングにおいて検出とデータの割り当ての2段階だと計算効率が悪いので、それをEndToEndで学習した手法

トラッキングには単一のビデオフレーム内のターゲットを特定する検出ステップと、検出されたターゲットを割り当てて既存の軌道に接続する関連付けステップがあり、検出器と埋め込み(re-ID)モデルが必要になる。
したがって、全体の推論時間は、大まかには2つの成分の和であり、目標数が増えるにつれて増加する。SDE法の特徴は、リアルタイムMOTシステムを構築する上で重要な課題となっている。

計算を節約するために、検出器と埋め込みモデルを単一のネットワークに統合することが考えられます。
このようにして、2つのタスクは同じ低レベルの特徴セットを共有することができ、再計算を避けることができます。

JDE の目的は、1 回のフォワードパスでターゲットの位置と外観の埋め込みを同時に出力

## Abstract

最近の複数物体追跡(MOT)システムは、通常、Tracking-by-detectionパラダイムに従っています。このシステムでは、1)ターゲットの定位のための検出モデルと、2)データの関連付けのための外観埋め込みモデルを備えています。この2つのモデルを別々に実行すると、2つのステップ間で共有される可能性のある構造を検討することなく、実行時間が単純に2つのステップの合計になってしまうため、効率性に問題が生じる可能性があります。これまでのリアルタイムMOTの研究は、アソシエーションステップに焦点を当てたものが多く、本質的にはリアルタイムアソシエーション手法であり、リアルタイムMOTシステムではありませんでした。本論文では，目標検出と外観埋め込みを共有モデルで学習できるMOTシステムを提案する．具体的には，単発検出器に外観埋め込みモデルを組み込み，検出とそれに対応する埋め込みを同時に出力できるようにする．このように，本システムはマルチタスク学習問題として定式化されており，アンカー分類，バウンディングボックス回帰，埋め込み学習の目的が複数存在し，個々の損失は自動的に重み付けされている．本研究では、入力解像度に応じて18.8～24.1FPSの動作速度を実現した世界初の（ほぼ）リアルタイムMOTシステムを報告します。また，SDE（Separate Detection and Embedding）学習を用いた最新のトラッカーと比較しても，追従精度は遜色ありません（MOT-16チャレンジではMOTA64.4％，MOTA66.1％）．コードとモデルは https://github.com/Zhongdao/Towards-Realtime-MOT に掲載されています。はじめに 多重物体追跡(MOT)は，物体の予測を目的としたものである．

## Introduction

ビデオシーケンス中の複数のターゲットの軌跡を予測することを目的とした複数物体追跡（MOT）は、自律運転からスマートビデオ解析に至るまでの重要な応用意義を支えています。この問題に対する支配的な戦略、すなわち検出による追跡パラダイム（Milan et al. 2016; Yu et al. 2016; Choi 2015）は、MOTを2つのステップに分解します。1）単一のビデオフレーム内のターゲットを特定する検出ステップと、2）検出されたターゲットを割り当てて既存の軌道に接続する関連付けステップである。つまり、システムには少なくとも2つの計算量の多いコンポーネント、すなわち、検出器と埋め込み(re-ID)モデルが必要になります。これらの手法を便宜的に分離検出埋め込み（SDE）法と呼ぶことにする。したがって、全体の推論時間は、大まかには2つの成分の和であり、目標数が増えるにつれて増加する。SDE法の特徴は、リアルタイムMOTシステムを構築する上で重要な課題となっている。

![image](https://user-images.githubusercontent.com/34574033/83053610-f2a4b400-a08b-11ea-8e05-64b5ba2cd8e0.png)

図1: (a) SDE(Separate Detection and Embedding)モデル、(b) 2ステージモデル、(c) JDE(Joint Detection and Embedding)モデルの比較。

計算を節約するために、検出器と埋め込みモデルを単一のネットワークに統合することが考えられます。このようにして、2つのタスクは同じ低レベルの特徴セットを共有することができ、再計算を避けることができます。検出器と埋め込み学習の共同学習のための1つの選択肢は、2段階検出器の一種であるFaster R-CNNフレームワーク(Ren et al. 2015)を採用することである。具体的には、第1段階である領域提案ネットワーク（RPN）はFaster R-CNNのままで、検出されたバウンディングボックスを出力し、第2段階であるFast R-CNN（Girshick 2015）は、分類のスーパービジョンをメトリック学習のスーパービジョンに置き換えることで、埋め込み学習モデルに変換することができる（Xiao et al. 2017; Voigtlaender et al. 2019）。ある程度の計算量を節約したにもかかわらず、この方法は2段階の設計のために速度が制限されており、通常は10fps未満で実行され、リアルタイムの要件からは程遠い。さらに、SDE法のようにターゲット数が増えると、2段目の実行時間も増加する。本論文では、MOTシステムの効率化を目的とした研究を行っている。本論文では、シングルショットディープネットワークにおいて、検出器と埋め込みモデル(JDE)を共同学習する初期の試みを紹介する。すなわち，提案するJDEは単一のネットワークを用いて，検出結果と検出されたボックスの出現埋め込みを同時に出力する．これに対して、SDE法と2ステージ法は、それぞれ再サンプリングされた画素（バウンディングボックス）と特徴量マップを特徴としている。バウンディングボックスと特徴マップの両方が、外観特徴抽出のための別個のre-IDモデルに供給されます。図1にSDE法、2ステージ法、提案されたJDE法の違いを簡単に示す。我々の手法は、SDE法とほぼ同等の精度でありながら、ほぼリアルタイムに近い実行時間を実現しています。例えば，MOT-16のテストセットでは，MOTA=64.4%で18.8FPSの実行時間を得ることができました．一方，Faster R-CNN + QAN embeddingでは，MOT-16のテストセットでMOTA=66.1%で6FPS以下でしか動作しません．高効率・高精度の共同学習フレームワークを構築するために、我々は、学習データ、ネットワークアーキテクチャ、学習目的、最適化戦略、検証指標などの基本的な側面を探求し、意図的に設計しています。まず、歩行者検知と人物検索に関する6つの公開データセットを収集し、統一的な大規模マルチラベルデータセットを作成する。この統一データセットでは、歩行者の境界ボックスをすべてラベル化し、歩行者の識別情報の一部をラベル化する。次に、特徴ピラミッドネットワーク(FPN) (Lin et al. 2017)をベースアーキテクチャとして選択し、どのような損失関数を用いてネットワークが最良の埋め込みを学習するかを議論する。そして、学習過程をアンカー分類、ボックス回帰、埋め込み学習のマルチタスク学習問題としてモデル化する。個々のタスクの重要性のバランスをとるために、タスク依存の不確実性(Kendall, Gal, and Cipolla 2018)を採用し、異種損失に動的に重み付けを行う。最後に、以下の評価指標を採用する。平均精度(AP)は検出器の性能を評価するために採用する。埋め込みの品質を評価するために、特定の偽警報率（FAR）における検索メトリックTrue Accept Rate（TAR）を採用している。全体的なMOT精度はCLEARメトリクス（Bernardin and Stiefelhagen 2008）、特にMOTAメトリクスによって評価される。また、本論文では、共同学習検出と埋め込みタスクのための新しい設定とベースラインを提供し、リアルタイムMOTに向けた研究を促進するものと考えています。

貢献度は以下のようにまとめられています。
- 本研究では、検出と埋め込みの共同学習のためのワンショットフレームワークであるJDEを紹介する。本研究では，オンラインMOTシステムとして，ほぼリアルタイムで動作し，最新のSDE（separate detection + embedding）手法と比較しても遜色のない精度を実現している．
- 本研究では、このような共同学習フレームワークをどのように構築するかについて、学習データ、ネットワークアーキテクチャ、学習目的、最適化戦略など多面的な観点から徹底した解析と実験を行う。
- 同じ学習データを用いた実験では、提案したJDEが様々な強力なSDEモデルの組み合わせと同等の性能を発揮し、最速の速度を達成することを示した。
- また，MOT-16を用いた実験では，学習データ量，精度，速度を考慮した場合，最新のMOTシステムと比較して，提案手法の優位性が実証された．

関連業務
複数物体追跡に関する最近の進歩は、主に以下のような側面に分類できる。

1. 関連付け問題をグラフ上のある種の最適化問題としてモデル化したもの(Wen et al. 2014; Zamir, Dehghan, and Shah 2012; Kim et al. 2015). 
2. 関連付けプロセスをエンドツーエンドのニューラルネットワークでモデル化する努力をするもの(Sun et al. 2019; Zhu et al. 2018). 
3. tracking-by-detection以外の新しいトラッキングパラダイムを求めるもの(Bergmann, Meinhardt, and LealTaixe 2019)。

これらのうち、最初の2つのカテゴリは、過去10年間でMOTに対する解決策として主流となっている。これらのトラッキング・バイ・ディテクション法では、検出結果と外観埋め込みが入力として与えられ、解決すべき問題はデータの関連付けのみである。リアルタイム性を謳っている手法もあるが，検出器のランタイムや外観特徴抽出を除いた場合，システム全体としてはまだ主張とはかけ離れたものになっている．これに対し，本研究では，アソシエーションステップのみではなく，MOT システム全体のランタイムを考慮している．システム全体で効率性を実現することは、より現実的な意味を持つ。
第3のカテゴリは、例えば、空間オフセットを予測して検出器に単一物体トラッカーを組み込むなど、新しいMOTパラダイムを探求する試みである（Bergmann, Meinhardt, and Leal-Taixe 2019）。これらの方法は、そのシンプルさゆえに魅力的であるが、追加の埋め込みモデルが導入されない限り、追跡精度は満足のいくものではない。そのため、性能と速度のトレードオフはまだ改善が必要である。
我々のアプローチは、データベースフレームの大規模なセットから問い合わせ先の人物を特定して認識することを目的とした人物検索タスクにも関連しています。このタスクに対するいくつかの解決策は、人物検出器と埋め込みモデルを共同で学習することでもある(Xiao et al. 2017)。それにもかかわらず、MOTと人物検索システムの間の大きな違いは、MOTの方が実行時間に対してより厳格な要件を持っていることであり、したがって、人物検索に関するアプローチを直接借用することはできない。
関連するもう一つのラインは、人のポーズ推定（Newell, Huang, and Deng 2017）および検出（Law and Deng 2018）で使用される連想埋め込みである。連想埋め込みと名付けられた低次元の密なベクトルマップは、人間の関節やボックスコーナーをグループ化するために学習される。しかし、連想は単一の画像にしか適用されないが、MOTでは異なるフレーム間の連想が必要であり、より識別性の高いエンベッディングが要求される。

![image](https://user-images.githubusercontent.com/34574033/83054932-1e289e00-a08e-11ea-91dc-0f782e4d7da8.png)

図 2: (a)ネットワークアーキテクチャと (b)予測ヘッドの図。予測ヘッドは複数のFPNスケールの上に追加される。各予測ヘッドでは、JDE の学習をマルチタスク学習問題としてモデル化しています。我々は、一連の補助パラメータ、すなわちタスク依存の不確実性を学習することで、異種損失に自動的に重み付けを行う。

検出と埋め込みの共同学習 問題設定
JDE の目的は、1 回のフォワードパスでターゲットの位置と外観の埋め込みを同時に出力することである。形式的には、学習データセット{I, B, y}があるとします。Ｎ ｉ＝１である。ここで、I ∈R c×h×wは画像フレームを示し、B ∈R k×4はこのフレーム内のk個のターゲットに対するバウンディングボックスのアノテーションを示し、y ∈Z kは部分的にアノテーションされたアイデンティティラベルを示し、-1はアイデンティティラベルのないターゲットを示す。JDEは、予測されたバウンディングボックスBˆ∈R kˆ×4と出現埋め込みFˆ∈R kˆ×D（Dは埋め込みの次元）を出力することを目的としている。以下の目的を満たすことが望ましい。

B∗は限りなくBに近い。- 距離メトリック d(-),∀(kt, kt+∆t, k0 t+∆t )が ykt+∆t = ykt, yk 0 t+∆t 6= ykt を満たすとき，d(fkt , fkt+∆t ) < d(fkt , fk 0 t+∆t )となり，fkt は Fˆ t からの行ベクトル，fkt+∆t , fk 0 t+∆t は Fˆ t+∆t からの行ベクトル，つまり，フレーム t と t+∆t にターゲットを埋め込むことができます．の行ベクトルであり，それぞれフレームtとt + ∆t内のターゲットの埋め込みです．

第1の目的は、モデルがターゲットを正確に検出することを要求する。第２の目的は、外観埋め込みが以下の特性を有することを要求する。連続したフレーム内の同一の同一性の観測間の距離は、異なる同一性の観測間の距離よりも小さくなければならない。距離メトリックｄ（-）は、ユークリッド距離またはコサイン距離であることができる。技術的には、２つの目的が両方とも満たされていれば、単純な連想戦略、例えばハンガリーアルゴリズムであっても、良好な追跡結果が得られるであろう。

アーキテクチャの概要
我々はFeature Pyramid Network (FPN) (Lin et al. 2017)のアーキテクチャを採用している。FPNは複数のスケールから予測を行うため、ターゲットのスケールが大きく異なる歩行者検知において改善をもたらす。図2にJDEで使用されているニューラルアーキテクチャを簡単に示します。入力されたビデオフレームは、まずバックボーンネットワークを順方向に通過し、それぞれ132、116、18の3つのスケールの特徴量マップを取得し、次に、最も小さいスケールの特徴量マップを取得します。次に、最も小さいサイズの特徴量（意味的に最も強い特徴量）を持つ特徴量マップをアップサンプリングし、スキップ接続により2番目に小さいスケールの特徴量マップと融合させ、他のスケールについても同様の処理を行う。最後に、3つのスケールの特徴量マップの上に予測ヘッドを追加します。予測ヘッドは、複数の畳み込み層を積層して構成され、サイズ（６Ａ＋Ｄ）×Ｈ×Ｗの密な予測マップを出力し、Ａはこのスケールに割り当てられたアンカーテンプレートの数、Ｄは埋め込みの次元である。密な予測マップは、1)サイズ2A×H×Wのボックス分類結果、2)サイズ4A×H×Wのボックス回帰係数、3)サイズD×H×Wの密な埋め込みマップの3つの部分（タスク）に分けられる。

検出するための学習
一般的に、検出ブランチは標準的なRPN (Ren et al. 2015)に似ているが、2つの修正がある。第一に、数、スケール、アスペクト比の観点からアンカーを再設計し、ターゲット、すなわち我々の場合は歩行者に適応できるようにする。アンカーテンプレートの数はA=4となるように12個とし、アンカーのスケール(幅)は11≒8×2 1/2から512=8×2 12/2までの範囲とした。第二に、前景/後景の割り当てに使用される二重のしきい値の適切な値を選択することが重要であることに注意してください。可視化することで、IOU>0.5 w.r.t.では、前景がほぼ確実になることがわかり、これは一般的な物体検出の一般的な設定と一致します。これは、一般的な物体検出の一般的な設定と一致しています。一方、IOU<0.4 w.r.t.のボックスは、一般的なシナリオで使用されている0.3ではなく、我々のケースでは背景とみなす必要があります。我々の予備的な実験では、これらのしきい値が誤報を効果的に抑制することが示されている。検出の学習目的には、前景・背景分類損失Lαとバウンディングボックス回帰損失Lβの2つの損失関数があります。Lαはクロスエントロピー損失として定式化され、Lβは平滑-L1損失として定式化される。回帰対象は、(Ren et al. 2015)と同様に符号化されている。

学習アピアランスエンベッディング
2 番目の目的は、メトリック学習問題、すなわち、同じアイデンティティのインスタンスが互いに近く、異なるアイデンティティのインスタンスが遠く離れている埋め込み空間を学習することである。この目的を達成するために、効果的な解決策は、トリプレット損失を用いることである（Schroff, Kalenichenko, and Philbin 2015）。トリプレットロスは、以前のMOTの研究でも使用されている(Voigtlaender et al. 2019)。形式的には、トリプレット損失Ltriplet = max(0, f >f - - f >f +)を使用し、ここで、f >はアンカーとして選択されたミニバッチ内のインスタンスであり、f +はf >と同様に正のサンプルを表し、f -は負のサンプルである。マージン項は便宜上無視されています。トリプレット損失のこの素朴な定式化には、いくつかの課題があります。第一に、訓練セットのサンプリング空間が膨大になることです。この作業では、ミニバッチを見て、このミニバッチ内のすべての負のサンプルと最も困難な正のサンプルをマイニングすることで、この問題に対処します。




# Tracking Objects as Points(CenterTrack)

## 要約

現在のフレームと直前のフレームを入力にしてトラッキングを行うで、未来の情報は使わないOnlineのトラッキングアルゴリズム

MOT17 challengeにおいてMOTAで67.3%を22 FPSで達成し、KITTI tracking benchmarkはMOTAは89.4%で15 FPSである。

簡単に3Dオブジェクトトラッキングへの拡張も可能



![image](https://user-images.githubusercontent.com/34574033/79063857-627afd00-7cdf-11ea-8184-b4857b49e10d.png)

